<html>
<head>

    <title>My first Three.js app</title>

    <link rel="stylesheet" type="text/css" href="../assets/css/tooltip.css">

    <style>
        body {
            margin: 0;
            font-size: 13px;
        }

        canvas {
            width: 100%;
            height: 100%
        }

        body {
            padding: 20px;
            margin: 20px;
        }

        .main {
            margin: 0 auto;
            width: 740px;
            color: #AAA;
            float: left;
            visibility: hidden;
        }

        .main a {
            color: #C3D4DE;
        }

        #vWrapper {
            margin-top: 100px;
            padding: 6px;
            width: 140px;
            opacity: 0.5;
            filter: alpha(opacity=50);
            background: #666;
        }

        #vWrapper a {
            color: #EEEEEE;
            text-decoration: none;
            display: block;
            padding: 6px 20px;
            background: #021e2f;
        }

        #vWrapper a:hover {
            color: #FFF;
            text-decoration: underline;
            background: #333;
        }

        .column {
            float: left;
            padding: 0 20px;
        }

        #phone {
            height: 700px;
            width: 600px;
            background-color: red;
            float: left;
        }

        .delete {
            color: deepskyblue;
        }

        #deletePreviewDiv {
            height: 200px;
            width: 350px;
            background-color: white;
        }

        .selectTile {
            display: block;
            margin: 0 auto;
        }

    </style>

</head>

<body>

<script src="../bower_components/three/three.min.js"></script>
<script src="http://mrdoob.github.com/three.js/examples/fonts/helvetiker_regular.typeface.js"></script>
<script src="../bower_components/three/helvetiker_regular.typeface.js"></script>
<script src="../bower_components/three/OrbitControls.js"></script>
<script src="../assets/javascript/t ooltip.js" type="text/javascript"></script>
<script src="../assets/javascript/interact.min.js"></script>
<script src="http://yui.yahooapis.com/3.18.1/build/yui/yui-min.js"></script>

<div class="main">
    <div id="vWrapper">
        <a href="#" onmouseover="tooltip.pop(this, '#sub1', {position:1, offsetX:-30, effect:'slide'})">TEXT</a>
        <a href="#" onmouseover="tooltip.pop(this, '#sub2', {position:1, offsetX:-20, effect:'slide', sticky: true})">IMAGE</a>
        <a href="#" onmouseover="tooltip.pop(this, '#sub3', {position:1, offsetX:-20, effect:'slide'})">COLOR</a>
        <a href="#" onmouseover="tooltip.pop(this, '#sub4', {position:1, offsetX:-20, effect:'slide'})">DELETE</a>
    </div>
</div>

<div id="phone">
</div>

<div ui-view="leftMenuContainer"></div>

<!--Menu Data-->

<div id="menu" style="display:none;">

    <div id="sub1">
        <h2>Edit Text</h2>

        <form id="addTxtForm" name="addTxtForm">
            <label>TEXT:</label><br>
            <input id="addTxt" name="txt" type="text">
            <input align="middle" id="button" onclick="addText()" type="button" value="Add">
        </form>

        <h3>font type: </h3>
        <select id="fontType" onchange="changeFontType()">
            <option value="Times New Roman">Times New Roman</option>
            <option value="Arial">Arial</option>
            <option value="Verdana">Verdana</option>
        </select>


        <h3>Color: </h3>
        <select id="fontColor" onchange="changeFontColor()">
            <option selected value="color">color</option>
            <option value="red">red</option>
            <option value="orange">orange</option>
            <option value="yellow">yellow</option>
            <option value="green">green</option>
            <option value="blue">blue</option>
            <option value="indigo">indigo</option>
            <option value="violet">violet</option>
            <option value="grey">grey</option>
            <option value="pink">pink</option>
            <option value="black">black</option>
        </select>

        <h3>font Size: </h3>
        <select id="fontSize" onchange="changeFontSize()">
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="30">30</option>
        </select>

        <h3>font style: </h3>
        <select id="fontStyle" onchange="changeFontStyle()">
            <option value="normal">normal</option>
            <option value="bold">bold</option>
            <option value="italic">italic</option>
            <option value="underline">underline</option>
        </select>

    </div>


    <div id="sub2">
        <div class="column">
            <h2>Upload Image</h2> <br>

            <input type="file" onchange="previewFile()"><br>

            <h4>Preview: </h4>

            <!--<div id="previewDiv"></div>-->
            <!--<br>-->

            <!--<h3>Transform</h3>-->

            <input align="middle" id="rotateButton" onclick="rotateTile()" type="button" value="Rotate">
            <input align="middle" class="transformButton" onclick="resizeTile()" type="button" value="transform">


        </div>
    </div>

    <div id="sub3">
        <h2>Add Design</h2> <br>

        <select id="border">
            <option selected>border</option>
        </select>

        <select id="tileColor" onchange="changeTileColor()">
            <option selected value="color">color</option>
            <option value="white">white</option>
            <option value="red">red</option>
            <option value="orange">orange</option>
            <option value="yellow">yellow</option>
            <option value="green">green</option>
            <option value="blue">blue</option>
            <option value="indigo">indigo</option>
            <option value="violet">violet</option>
            <option value="grey">grey</option>
            <option value="pink">pink</option>
            <option value="black">black</option>
        </select>

        <br><br>

        <select id="shape">
            <option selected>shape</option>
        </select>

        <select id="pattern">
            <option selected>pattern</option>
        </select>

        <input align="middle" class="transformButton" onclick="resizeTile()" type="button" value="transform">

    </div>

    <div id="sub4">
        <h2>Remove Tiles</h2> <br>
        <h4>Preview:</h4>

        <div id="deletePreviewDiv"></div>

        <h4 class="delete">Are you sure you want to remove this tile?</h4>
        <input type="button" value="Remove" onClick="deleteTile()">

    </div>

</div>
<div id="div1" ondrop="drop(event)" ondragover="allowDrop(event)" draggable="true" ondragstart="drag(event)"></div>
<div id="drag1"><img src="../assets/images/click.png" draggable="true"
                     ondragstart="drag(event)" width="150" height="150"></div>
<div id="drag2"><img src="../assets/images/cat.jpg" draggable="true"
                     ondragstart="drag(event)" width="150" height="150"></div>

<script>

    var selectedImg = "";
    var selectColor = "#ffffff";
    var tileWidth = 150;
    var tileHeight = 150;
    var selectedTile;
    var originalColor = "red";
    var textColor;
    var selectedObject;
    var tempCloneOfSkeleton;
    var draggingTilePosition;
    var currentDraggingTile;
    var targetedDiv;
    var resetTile;
    var skeletonSize;


    /*
     this function create skeleton with tiles.
     */

    function createSkeleton(x, y) {

        var i;

        var skeleton = document.getElementById("phone");
        skeleton.style.height = tileHeight * y;
        skeleton.style.width = tileWidth * x;
        skeletonSize = x * y;

        for (i = 0; i < skeletonSize; i++) {
            var tile = document.createElement("div");
            tile.id = "tile" + i;
            tile.className = 'containerTIle';
            tile.style.width = tileWidth;
            tile.style.height = tileHeight;
            tile.style.float = "left";
            tile.style.backgroundColor = 'red';
            tile.empty = true;
            //tile.addEventListener("click", selectTile, false);

            //var imageDiv = document.getElementById("drag1");
            //var imgResize = imageDiv.getElementsByTagName("img")[0];
            //imgResize.width = tileWidth;
            //imgResize.height = tileHeight;

            var clickContainer = document.getElementById("div1");
            clickContainer.style.width = tileWidth;
            clickContainer.style.height = tileHeight;
            //Had to clone it because I couldn't add ondrop and ondragover attributes to the tile

            var cln = clickContainer.cloneNode(true);
            cln.addEventListener("click", selectTile, false);
            cln.name = 'selectTile';
            cln.id = "div" + i;
            cln.style.zIndex = "2";
            cln.className = 'selectTile';
            tile.appendChild(cln);
            skeleton.appendChild(tile);
        }
    }

    function selectTile(evt) {
        if(evt.target.parentNode.empty == false) {
            console.log("opening menu");
            var menu = document.getElementById("vWrapper");
            menu.style.visibility = "visible";
            console.log(menu);


            selectedObject = evt.target;
            console.log(evt.target.parentNode.empty);
            selectedTile = evt.target.parentNode.id;
            AddDeletePreview();

            originalColor = document.getElementById(selectedTile).style.backgroundColor;
            //document.getElementById(selectedTile).style.backgroundColor = "white";
            document.getElementById(selectedTile).style.borderStyle = "solid";
            document.getElementById(selectedTile).style.borderWidth = "1px";
        }
        else if(selectedTile != null){
            deselectTile();
            console.log("closing menu");
        }
    }

    function deselectTile() {

        var x = document.getElementById("tileColor");
        var res = x.options[x.selectedIndex].value;

        if (res != "color") {
            document.getElementById(selectedTile).style.backgroundColor = res;
            document.getElementById("tileColor").value = "color";
        } else {
            document.getElementById(selectedTile).style.backgroundColor = originalColor;
        }

        document.getElementById(selectedTile).style.borderStyle = "";
        document.getElementById(selectedTile).style.borderWidth = "";
        var menu = document.getElementById("vWrapper");
        menu.style.visibility = "hidden";
    }

    createSkeleton(3, 5);


    function changeTileColor() {

        var x = document.getElementById("tileColor");
        var res = x.options[x.selectedIndex].value;
        document.getElementById(selectedTile).style.backgroundColor = res;

    }

    function addText() {

        document.getElementById(selectedTile).innerText = document.getElementById("addTxt").value;
        //document.getElementById(selectedTile).style.zIndex = "2";
        document.getElementById(selectedTile).style.textAlign = 'center';
        document.getElementById(selectedTile).style.lineHeight = document.getElementById(selectedTile).style.height;
        document.getElementById("addTxtForm").reset();

    }

    function changeFontColor() {

        var x = document.getElementById("fontColor");
        var res = x.options[x.selectedIndex].value;
        document.getElementById(selectedTile).style.color = res;

    }

    function changeFontSize() {

        var x = document.getElementById("fontSize");
        document.getElementById(selectedTile).style.fontSize = x.options[x.selectedIndex].value;

    }

    function changeFontStyle() {

        var x = document.getElementById("fontStyle");
        if (x.options[x.selectedIndex].value == "italic") {
            document.getElementById(selectedTile).style.fontStyle = x.options[x.selectedIndex].value;
        } else if (x.options[x.selectedIndex].value == "underline") {
            document.getElementById(selectedTile).style.textDecoration = x.options[x.selectedIndex].value;
        } else {
            document.getElementById(selectedTile).style.fontWeight = x.options[x.selectedIndex].value;
        }
    }

    function changeFontType() {
        var x = document.getElementById("fontType");
        document.getElementById(selectedTile).style.fontFamily = x.options[x.selectedIndex].value;
    }

    function previewFile() {

        var file = document.querySelector('input[type=file]').files[0]; //sames as here
        var reader = new FileReader();

        reader.onloadend = function () {
            var img = document.createElement("img");
            img.src = reader.result;
            img.style.height = tileWidth;
            img.style.width = tileHeight;

            //preview
//            document.getElementById("previewDiv").appendChild(img);
//            console.log(img.src);

            document.getElementById(selectedTile).style.backgroundImage = "url(" + img.src + ")";
            document.getElementById(selectedTile).style.backgroundSize = 'cover';

        }

        if (file) {
            reader.readAsDataURL(file); //reads the data as a URL
        }

    }

    function AddDeletePreview() {

        var preview = document.getElementById("deletePreviewDiv");
        var previewClone = selectedObject.cloneNode(true);
        previewClone.style.margin = "0 auto";

        if (selectedTile != null) {

            preview.innerHTML = "";
            preview.appendChild(previewClone);
        }

    }

    function deleteTile() {

        originalColor = "red";
        document.getElementById(selectedTile).style.background = null;
        document.getElementById(selectedTile).innerText = "";
        deselectTile();

    }

    function rotateTile() {
        document.getElementById(selectedTile).style.webkitTransform += 'rotate(45deg)';
    }

    function resizeTile() {

        var x = 0, y = 0;
        var element = document.getElementById(selectedTile);

        interact(element)

            .draggable({
                snap: {
                    targets: [
                        interact.createSnapGrid({x: 20, y: 20})
                    ],
                    range: Infinity,
                    relativePoints: [{x: 0, y: 0}]
                },

                inertia: true,

                restrict: {
                    restriction: element.parentNode,
                    elementRect: {top: 0, left: 0, bottom: 1, right: 1},
                    endOnly: true
                }

            })

            .on('dragmove', function (event) {
                x += event.dx;
                y += event.dy;

                event.target.style.webkitTransform =
                    event.target.style.transform =
                        'translate(' + x + 'px, ' + y + 'px)';
            })

            .resizable({
                edges: {left: true, right: true, bottom: true, top: true}
            })

            .on('resizemove', function (event) {

                var target = event.target,
                    x = (parseFloat(target.getAttribute('data-x')) || 0),
                    y = (parseFloat(target.getAttribute('data-y')) || 0);

                if (target.style.width <= '150px' && target.style.height <= '150px') {

                    // update the element's style

                    target.style.width = event.rect.width + 'px';
                    target.style.height = event.rect.height + 'px';

                    // translate when resizing from top or left edges
                    x += event.deltaRect.left;
                    y += event.deltaRect.top;

                    target.style.webkitTransform = target.style.transform =
                        'translate(' + x + 'px,' + y + 'px)';

                    target.setAttribute('data-x', x);
                    target.setAttribute('data-y', y);

                    //target.textContent = event.rect.width + 'x' + event.rect.height;

                }

            });
    }


    function allowDrop(ev) {
       // console.log(ev.target.parentNode);
        //console.log(hasTile(ev));
        if(hasTile) {
            ev.preventDefault();
        }
    }

    //
    function hasTile(element) {
        if(element.empty == true){
            return false;
        }
        else{
            return true;
        }
    }

    function drag(ev) {
       // console.log("dragging");
       // console.log(ev.toElement.parentNode);
        currentDraggingTile = ev.toElement.parentNode;

        showAvalaibleTileSpace();
    }

    function showAvalaibleTileSpace(){
        var i;
        var skeleton = document.getElementById("phone");
        tempCloneOfSkeleton = skeleton.cloneNode(true);
        for (i = 0; i < skeletonSize; i++) {
            var tile = document.getElementById("tile" + i);
            //tile.style.backgroundColor = "#0000FF";
            tile.style.backgroundColor = "#0000FF";
        }
    }

    function resetColorOfAvailableTiles(){
        var i;
        for (i = 0; i < skeletonSize; i++) {
            var tile = document.getElementById("tile" + i);
            tile.style.backgroundColor = tempCloneOfSkeleton.children[i].style.backgroundColor;
        }
    }

    function drop(ev) {
        //console.log(ev.target);
        resetColorOfAvailableTiles();
        ev.preventDefault();
       // console.log("dropping");
        //console.log(ev.toElement.id);

        targetedDiv = document.getElementById(ev.toElement.id);
        //console.log(targetedDiv);


        targetedDiv.innerHTML = targetedDiv.innerHTML + currentDraggingTile.innerHTML;
        targetedDiv.empty = false;
        currentDraggingTile.innerHTML = "";

        selectTile(ev);

    }

</script>
</body>
</html>
